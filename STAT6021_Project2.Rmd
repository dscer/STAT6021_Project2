---
title: "STAT6021 Project 2"
author: "Dominic Scerbo (ybt7qt)"
date: "4/23/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
```

## Libraries

```{r, echo=FALSE}
library(tidyverse)
library(gridExtra)
library(ROCR)
library(leaps)
set.seed(1)
```

## Pre-Processing

Objectives

-   Read data

-   Convert types as needed

-   Apply transformations

```{r}
df <- read.csv('.//data//kc_house_data.csv', header = T)
df$waterfront <- as.factor(df$waterfront)
df$condition <- as.factor(df$condition)
df$view <- as.factor(df$view)
```

The required transformation are:

-   Waterfront is a categorical variable 1 is waterfront 0 not waterfront, convert to factor

-   Condition is a categorical variable describing a rating from X to X the higher meaning better condition, convert to factor

-   View is a categorical variable describing a rating from X to X the higher meaning the best better view, convert to factor

## Visualization and Analysis

Objectives

-   Discover relationships

-   Proportions

-   Distributions

-   Densities

```{r}
mytab<-table(df$waterfront, df$view)
mytab
```

```{r}
prop.table(mytab, 1)
```

As the quality of the view increases the proportion of the waterfront properties increase.

```{r}
mytab<-table(df$waterfront, df$condition)
mytab
```

```{r}
prop.table(mytab, 1)
```

Left skewed distribution for both type of properties.

```{r}
dn1<-ggplot(train, aes(x=price, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="price", title="Price by Waterfront")

dn2<-ggplot(train, aes(x=bedrooms, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="bedrooms", title="Bedrooms by Waterfront")

dn3<-ggplot(train, aes(x=bathrooms, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="bathrooms", title="Bathrooms by Waterfront")

dn4<-ggplot(train, aes(x=sqft_living, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="sqft_living", title="Sqft Living by Waterfront")

dn5<-ggplot(train, aes(x=sqft_lot, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="sqft_lot", title="Sqft Lotby Waterfront")

dn6<-ggplot(train, aes(x=floors, color=waterfront))+
  geom_density()+
  labs(x="waterfront", y="floors", title="Floor by Waterfront")

grid.arrange(dn1, dn2, dn3, dn4, dn5, dn6, ncol = 2, nrow = 3)
```

```{r}
bp1<-ggplot(train, aes(x=waterfront, y=price))+
  geom_boxplot()+
  labs(x="waterfront", y="price", title="Price by Waterfront")

bp2<-ggplot(train, aes(x=waterfront, y=bedrooms))+
  geom_boxplot()+
  labs(x="waterfront", y="bedrooms", title="Bedrooms by Waterfront")

bp3<-ggplot(train, aes(x=waterfront, y=bathrooms))+
  geom_boxplot()+
  labs(x="waterfront", y="bathrooms", title="Bathrooms by Waterfront")

bp4<-ggplot(train, aes(x=waterfront, y=sqft_living))+
  geom_boxplot()+
  labs(x="waterfront", y="sqft_living", title="Sqft Living by Waterfront")

bp5<-ggplot(train, aes(x=waterfront, y=sqft_lot))+
  geom_boxplot()+
  labs(x="waterfront", y="sqft_lot", title="Sqft Lotby Waterfront")

bp6<-ggplot(train, aes(x=waterfront, y=floors))+
  geom_boxplot()+
  labs(x="waterfront", y="floors", title="Floor by Waterfront")

grid.arrange(bp1, bp2, bp3, bp4, bp5, bp6, ncol = 2, nrow = 3)
```

## Data Prep

Objectives

-   Remove null values

-   Remove unnecessary variables

-   Split data into train and test dataset

```{r}
Data <- df %>% 
  select(-c(1,2,10,12,13,14,15,16,17,18,19,20,21)) %>%
  drop_na()

sample<-sample.int(nrow(Data), floor(.80*nrow(Data)), replace = F)
train<-Data[sample, ]
test<-Data[-sample, ]
```

## Preliminary Modeling

Objective: First cut modeling using all regression methods to find feasible models

```{r}
allreg2 <- regsubsets(waterfront ~., data=Data, nbest=2)
summary(allreg2)

coef(allreg2, which.max(summary(allreg2)$adjr2))
coef(allreg2, which.min(summary(allreg2)$cp))
coef(allreg2, which.min(summary(allreg2)$bic))
```

## Modeling

Objective: Create primary model of interest

```{r}
result<-glm(waterfront~price+bedrooms+sqft_living+sqft_lot+floors+condition, family="binomial", data=train)
summary(result)
```

## Test and Evaluation

Objectives: Evaluate the significance of predictors and reduce the model as needed

```{r}
reduced<-glm(waterfront~price+bedrooms+sqft_living, family="binomial", data=train)
summary(reduced)
```

```{r}
deltaG2<-reduced$null.deviance-reduced$deviance
deltaG2
```

```{r}
1-pchisq(deltaG2,3)
```

$H_0 : \beta_1 = · · · = \beta_3 = 0$
$H_a:$ at least one of the coefficients in $H_0$ is not 0.
The test statistic is 450.4117 with a p-value that is 0. So we reject the null hypothesis, our model is useful.

## Validation

Objective

-   Generate predictions

-   Create ROC plot

-   Evaluate performance via AUC

-   Evaluate confusion matrix results

```{r}
preds<-predict(result,newdata=test, type="response")
rates<-prediction(preds, test$waterfront)
roc_result<-performance(rates,measure="tpr", x.measure="fpr")
```

```{r}
plot(roc_result, main="ROC Curve for Waterfront", colorize=TRUE)
lines(x = c(0,1), y = c(0,1), col="red")
```

```{r}
auc<-performance(rates, measure = "auc")
auc@y.values
```

```{r}
table(test$waterfront, preds>0.8)
```

```{r}
res <- round(preds, 4)
#res
```

```{r}
plot(res)
```

```{r}
table_mat <- table(test$waterfront, preds>0.5)
table_mat
```

```{r}
FPR <- round(4/(4285+4), 4)
paste0('The FPR is: ', FPR)
FNR <- round(29/(29+5),4)
paste0('The FNR is: ', FNR)
err <- round((29+4)/(4285+4+29+5),4)
paste0('The Error Rate is: ', err)
```

```{r}
precision <- function(matrix) {
	# True positive
    tp <- matrix[2, 2]
	# false positive
    fp <- matrix[1, 2]
    return (tp / (tp + fp))
}

recall <- function(matrix) {
# true positive
    tp <- matrix[2, 2]# false positive
    fn <- matrix[2, 1]
    return (tp / (tp + fn))
}

prec <- precision(table_mat)
paste0("Precision: ", round(prec, 4))
rec <- recall(table_mat)
paste0("Recall: ", round(rec, 4))
```

```{r}
f1 <- 2 * ((prec * rec) / (prec + rec))
f1
```

-   Precision: Precise as possible with prediction

-   Recall: Catch many data points labeled as true as possible even though the precision is low

## Predictions

Objective: Create new sample and obtain prediction log odds, odds, and probability

```{r}
newdata<-data.frame(price=650000, bedrooms=3, sqft_living=3000)
```

```{r}
##log odds
predict(reduced,newdata)
```

```{r}
##odds
odds<-exp(predict(reduced,newdata))
odds
```

```{r}
##convert odds to probability
prob<-odds/(1+odds)
prob
```
